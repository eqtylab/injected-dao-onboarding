<html>
  <head>
    <title>Injected Onboarding</title>
    <!-- Load styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- 1. Install Magic SDK -->
    <script src="https://auth.magic.link/sdk"></script>
    <!-- 2. Load onboarding injection script -->
    <script src="js/onboarding.js"></script>
  </head>
  <body>
    <div id="onboarding-frame"></div>
    <button id="join-dao-cta-btn">Join DAO</button>
    <!-- 3. Setup onboarding UI -->
    <script defer>
      console.log("Performing Onboarding UI setup...");

      // Replace these with your deployment's own relevant variables
      const baseUrl = window.BASE_URL;                  // "https://localhost:3000"
      const magicApiKey = window.MAGIC_PUBLISHABLE_KEY; // "pk_live_..."
      const lockAddress = window.PAYWALL_LOCK_ADDRESS;  // "0x..."

      if (typeof window?.Magic === "undefined") {
        throw new Error("No Magic object found!");
      }

      if (typeof window?.Onboarding === "undefined") {
        throw new Error("No Onboarding object found!");
      }

      const onboarding = new Onboarding({
        id: 'onboarding-wizard',
        network: 'goerli',
        magicConfig: {
          apiKey: magicApiKey,
          oauthRedirects: [{
            provider: 'discord',
            redirectURI: new URL("/callback", baseUrl).href
          }],
          callbackRoute: '/callback',
        },
        unlockConfig: {
          name: "DAO Membership",
          lockAddress,
        },
      });

      // Setup click handler to render onboarding UI
      const ctaElement = document.getElementById('join-dao-cta-btn');
      ctaElement.onclick = e => {
        e.preventDefault();
        onboarding.render(document.getElementById('onboarding-frame'));
      };
      onboarding.render(document.getElementById('onboarding-frame'));
    </script>
  </body>
</html>
